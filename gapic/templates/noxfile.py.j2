{% extends "_base.py.j2" %}

{% block content %}
import os

import nox  # type: ignore


@nox.session(python=['3.6', '3.7'])
def unit(session):
    """Run the unit test suite."""

    session.install('coverage', 'pytest', 'pytest-cov')
    session.install('-e', '.')

    session.run(
        'py.test',
        '--quiet',
        '--cov={{ api.naming.module_namespace|join("/") }}/{{ api.naming.versioned_module_name }}/',
        '--cov-config=.coveragerc',
        '--cov-report=term',
        '--cov-report=html',
        os.path.join('tests', 'unit', '{{ api.naming.versioned_module_name }}'),
    )


@nox.session(python=['3.6', '3.7'])
def mypy(session):
    """Run the type checker."""
    session.install('mypy')
    session.install('.')
    session.run(
        'mypy',
        {%- if api.naming.module_namespace %}
        '{{ api.naming.module_namespace[0] }}',
        {%- else %}
        '{{ api.naming.versioned_module_name }}',
        {%- endif %}
    )
    
    
@nox.session(python="3.6")
def blacken(session):
    """Run black.
    Format code to uniform standard.
    
    This currently uses Python 3.6 due to the automated Kokoro run of synthtool.
    That run uses an image that doesn't have 3.6 installed. Before updating this
    check the state of the `gcp_ubuntu_config` we use for that Kokoro run.
    """
    session.install("black")
    session.run(
        "black",
        {%- if api.naming.module_namespace %}
        '{{ api.naming.module_namespace[0] }}',
        {%- else %}
        '{{ api.naming.versioned_module_name }}',
        {%- endif %}
        "tests",
    )

{% endblock %}
